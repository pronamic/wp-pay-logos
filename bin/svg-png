#!/usr/bin/env php
<?php

$iterator = new RecursiveDirectoryIterator( __DIR__ . '/../src/' );

$iterator = new RecursiveIteratorIterator( $iterator );

//$iterator = new RegexIterator( $iterator, '/^.+\.svg$/i', RecursiveRegexIterator::GET_MATCH );

foreach ( $iterator as $file ) {
	if ( 'svg' !== $file->getExtension() ) {
		continue;
	}
	
	echo $file->getRealPath(), PHP_EOL;

	$filename = $file->getFilename();

	echo $filename, PHP_EOL;

	$result = preg_match( '/-(?<width>\d*)x(?<height>\d*)./', $filename, $matches );

	if ( ! array_key_exists( 'width', $matches ) ) {
		continue;
	}

	if ( ! array_key_exists( 'height', $matches ) ) {
		continue;
	}

	$width  = $matches['width'];
	$height = $matches['height'];

	$info = new SplFileInfo( $file->getRealPath() );

	$densities = array(
		'1' => 1,
		'2' => 2,
		'3' => 3,
		'4' => 4,
	);

	$png = $info->getPath() . '/' . $info->getBasename( '.' . $info->getExtension() ) . '.png';

	$command = sprintf(
		'inkscape --export-png=%s --export-width=%d --export-height=%d %s',
		$png,
		$width,
		$height,
		$file->getRealPath()
	);

	passthru( $command );
}
